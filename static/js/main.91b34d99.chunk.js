(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{232:function(e,t,a){e.exports=a(404)},237:function(e,t,a){},284:function(e,t){},286:function(e,t){},297:function(e,t){},299:function(e,t){},326:function(e,t){},328:function(e,t){},329:function(e,t){},335:function(e,t){},337:function(e,t){},355:function(e,t){},358:function(e,t){},374:function(e,t){},377:function(e,t){},404:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(13),u=a.n(o),c=(a(237),a(211)),s=a(20),i=a(45),l=a.n(i),p=a(69),d=a(92),h=a(93),m=a(104),f=a(103),b=a(446),g=a(454),v=a(455),k=a(452),E=a(108),x=a(8),y=a(49),S=a.n(y),C=a(212),w=a(25),I=a(107),O=a.n(I),j=a(130),D=a.n(j),T=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={title:"",author:"",pages:"",description:"",edition:"",year:"",language:"",publisher:"",isbn:"",issn:"",courseDepartment:"",courseCode:""},e}return Object(h.a)(a,[{key:"getMd5",value:function(){var e=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){var n=new FileReader;n.onloadend=function(t){var a=D.a.lib.WordArray.create(n.result);e(D.a.MD5(a).toString())},n.onerror=function(e){a(e)},n.readAsArrayBuffer(t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"formSubmit",value:function(){var e=Object(p.a)(l.a.mark((function e(t){var a,n,r,o,u,c,s,i,d,h,m,f,b,g,v,k,E,x,y,w;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=new FormData,n=document.getElementById("file"),a.append("file",n.files[0]),e.next=6,this.getMd5(n.files[0]);case 6:return r=e.sent,o=this.state,u=o.title,c=o.author,s=o.pages,i=o.description,d=o.edition,h=o.year,m=o.publisher,f=o.isbn,b=o.issn,g=o.courseDepartment,v=o.courseCode,k=o.language,E={title:u,author:c,pages:s,description:i,edition:d,year:h,publisher:m,isbn:f,issn:b,courseDepartment:g,courseCode:v,language:k},e.prev=9,e.next=12,S.a.get("https://cors-anywhere.herokuapp.com/http://gen.lib.rus.ec/book/index.php?md5=".concat(r));case 12:if(200!==e.sent.status){e.next=39;break}return console.log("Already on libgen."),e.next=17,S.a.get("https://sbutextbooks.herokuapp.com/books");case 17:x=e.sent,y=Object(C.a)(x.data.textbooks),e.prev=19,y.s();case 21:if((w=y.n()).done){e.next=27;break}if(w.value.md5!==r){e.next=25;break}return e.abrupt("return");case 25:e.next=21;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(19),y.e(e.t0);case 32:return e.prev=32,y.f(),e.finish(32);case 35:return E={title:u,author:c,pages:s,description:i,edition:d,year:h,publisher:m,isbn:f,issn:b,courseDepartment:g,courseCode:v,language:k,md5:r},e.next=38,S()({method:"POST",url:"https://sbutextbooks.herokuapp.com/upload",data:O.a.stringify(E)});case 38:return e.abrupt("return");case 39:e.next=44;break;case 41:e.prev=41,e.t1=e.catch(9),console.log("not found on libgen... uploading...");case 44:S()({method:"POST",url:"https://cors-anywhere.herokuapp.com/https://library.bz/main/upload/",data:a,headers:{"Content-Type":"multipart/form-data"},auth:{username:"genesis",password:"upload"}}).then((function(e){var t=e.headers["x-final-url"];t="https://cors-anywhere.herokuapp.com/".concat(t),S()({url:t,method:"POST",auth:{username:"genesis",password:"upload"},data:O.a.stringify(E)}).then(function(){var e=Object(p.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.data.toString().includes("The record has been successfully saved.")||t.data.toString().includes("The file is already in the upload queue and awaiting moderation")){e.next=4;break}alert("Upload failed!"),e.next=7;break;case 4:return E={title:u,author:c,pages:s,description:i,edition:d,year:h,publisher:m,isbn:f,issn:b,courseDepartment:g,courseCode:v,language:k,md5:r},e.next=7,S()({method:"POST",url:"https://sbutextbooks.herokuapp.com/upload",data:O.a.stringify(E)});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).catch((function(e){console.log(e)}));case 45:case"end":return e.stop()}}),e,this,[[9,41],[19,29,32,35]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{margin:"2em"}},r.a.createElement(w.Form,{onSubmit:function(t){return e.formSubmit(t)}},r.a.createElement("legend",null,"Upload a Textbook"),r.a.createElement(w.Input,{id:"file",type:"file"}),r.a.createElement(w.Input,{label:"Title*",onChange:function(t){return e.setState({title:t.target.value})},placeholder:"Title",required:!0}),r.a.createElement(w.Input,{label:"Author*",onChange:function(t){return e.setState({author:t.target.value})},placeholder:"Author",required:!0}),r.a.createElement(w.Input,{label:"Page Count",onChange:function(t){return e.setState({pages:t.target.value})},placeholder:"Page Count"}),r.a.createElement(w.Textarea,{label:"Description",onChange:function(t){return e.setState({description:t.target.value})},placeholder:"Description (optional)"}),r.a.createElement(w.Input,{label:"Edition*",onChange:function(t){return e.setState({edition:t.target.value})},placeholder:"ex. 1st, 2nd, 5th, etc.",required:!0}),r.a.createElement(w.Input,{label:"Language*",onChange:function(t){return e.setState({language:t.target.value})},placeholder:"Language",required:!0}),r.a.createElement(w.Input,{label:"Release Year",onChange:function(t){return e.setState({year:t.target.value})},placeholder:"Release Year"}),r.a.createElement(w.Input,{label:"Publisher",onChange:function(t){return e.setState({publisher:t.target.value})},placeholder:"Publisher"}),r.a.createElement(w.Input,{label:"ISBN*",onChange:function(t){return e.setState({isbn:t.target.value})},placeholder:"ISBN",required:!0}),r.a.createElement(w.Input,{label:"ISSN",onChange:function(t){return e.setState({issn:t.target.value})},placeholder:"ISSN"}),r.a.createElement(w.Input,{label:"Course Department",onChange:function(t){return e.setState({courseDepartment:t.target.value})},placeholder:"ex. AMS, CSE, BIO, etc.",required:!0}),r.a.createElement(w.Input,{label:"Course Code",onChange:function(t){return e.setState({courseCode:t.target.value})},placeholder:"ex. 101, 300, etc.",required:!0}),r.a.createElement(w.Button,{variant:"raised"},"Submit")))}}]),a}(r.a.Component),A=[{name:"course",title:"Course"},{name:"textbook",title:"Textbook"},{name:"md5",title:"Download"}],P=function(e){var t=e.value;return r.a.createElement("span",null,r.a.createElement("a",{href:"http://gen.lib.rus.ec/book/index.php?md5=".concat(t)},"Download "))},q=function(e){return r.a.createElement(x.b,Object.assign({formatterComponent:P},e))},B=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(){var e;Object(d.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={textbooks:[],search:"",loaded:!1},e}return Object(h.a)(a,[{key:"componentDidMount",value:function(){var e=Object(p.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://sbutextbooks.herokuapp.com/books",e.next=3,S.a.get("https://sbutextbooks.herokuapp.com/books");case 3:t=e.sent,this.setState({textbooks:t.data.textbooks.map((function(e){return{course:e.course.toUpperCase(),textbook:"".concat(e.title," (").concat(e.edition," edition),\n                               ").concat(e.author),md5:e.md5,approved:e.approved}}))}),this.setState({loaded:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return this.state.loaded?r.a.createElement("div",{style:{margin:"2em"}},r.a.createElement("a",{href:"https://sbutextbook.github.io/client/#/upload/"},r.a.createElement(k.a,{style:{backgroundColor:"grey"}},"Upload")),r.a.createElement("hr",null),r.a.createElement(g.a,{options:this.state.textbooks.map((function(e){return e.course})).sort(),renderInput:function(t){return r.a.createElement(v.a,Object.assign({},t,{label:"Course",variant:"outlined",onChange:function(t){return e.setState({search:t.target.value})}}))}}),r.a.createElement(b.a,null,r.a.createElement(E.a,{rows:this.state.textbooks.filter((function(t){return t.approved&&t.course.includes(e.state.search.toUpperCase())})),columns:A},r.a.createElement(x.k,{defaultSorting:[{columnName:"course",direction:"asc"}]}),r.a.createElement(x.h,null),r.a.createElement(q,{for:["md5"]}),r.a.createElement(E.b,null),r.a.createElement(E.c,null)))):r.a.createElement("span",null,"Loading...")}}]),a}(r.a.Component);var M=function(){return r.a.createElement(c.a,{basename:"/"},r.a.createElement("div",{className:"App"},r.a.createElement(s.a,{exact:!0,path:"/",component:B}),r.a.createElement(s.a,{path:"/upload",component:T})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[232,1,2]]]);
//# sourceMappingURL=main.91b34d99.chunk.js.map